machine:
    python:
        version: 3.4.2
    services:
        - docker

dependencies:
    cache_directories:
        - "~/cache"
    override:
        - docker/cache.sh restore
        - mv ~/cache ~/cache.old; mkdir ~/cache
        - ./docker.sh build
        - docker/cache.sh save

test:
    override:
        - ./docker.sh run bash -lc "./scion.sh coverage -v"
        - ./docker.sh run bash -lc "./scion.sh lint"
        - ./docker.sh run bash -lc "make -C sphinx-doc clean html"
    post:
        - cp -a htmlcov "$CIRCLE_ARTIFACTS"/coverage
        - cp -a sphinx-doc/_build/html "$CIRCLE_ARTIFACTS"/docs
